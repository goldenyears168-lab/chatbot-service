# FAQ 匹配逻辑改进说明

## 问题分析

用户反馈：实测还是有调用 API，希望确保所有问题都能正确匹配到 FAQ，避免不必要的 API 调用。

## 改进内容

### 1. 增强匹配逻辑

**之前**：只支持精确匹配和标准化匹配（去除标点、空格）

**现在**：支持 4 种匹配方式

1. **精确匹配**：完全相同的文本
2. **标准化匹配**：去除标点、空格、转小写后匹配
3. **关键词匹配**：提取关键词，如果匹配的关键词数量 >= 阈值，则匹配成功
4. **子串匹配**：检查是否包含 FAQ 问题的完整文本（作为子串）

### 2. 匹配优先级

```
精确匹配 > 标准化匹配 > 关键词匹配 > 子串匹配
```

### 3. 关键词匹配规则

- 提取关键词时去除常见停用词（的、了、吗、呢、啊、吧、是、有、在、和、与、或、及、等）
- 最小匹配阈值：至少 3 个关键词，或 50% 的关键词（取较大值）
- 确保匹配的关键词数量 >= 3

### 4. 子串匹配规则

- 检查用户输入是否包含 FAQ 问题的完整文本，或反之
- 确保匹配的文本长度 >= 5 个字符（避免太短的误匹配）

## 调试日志

在开发环境中，会输出详细的匹配日志：

- `FAQ matched (exact)` - 精确匹配
- `FAQ matched (normalized)` - 标准化匹配
- `FAQ matched (keywords)` - 关键词匹配
- `FAQ matched (substring)` - 子串匹配
- `FAQ not found` - 未找到匹配

## 使用建议

### 1. 检查控制台日志

在浏览器开发者工具的控制台中，可以看到详细的匹配信息，帮助调试为什么某些问题没有匹配到。

### 2. 确保 FAQ 数据完整

所有问题都应该：
- 有 `next_best_actions` 字段
- `next_best_actions` 数组包含 3 个相关后续问题
- 问题文本清晰、准确

### 3. 测试匹配逻辑

可以测试以下场景：
- 完全相同的文本
- 有标点符号差异的文本
- 有空格差异的文本
- 包含关键词但不完全相同的文本
- 包含 FAQ 问题作为子串的文本

## 预期效果

- ✅ 提高匹配成功率，减少不必要的 API 调用
- ✅ 支持更多变体的用户输入
- ✅ 提供详细的调试信息，便于排查问题
- ✅ 确保所有菜单项和预测问题都能正确匹配

## 注意事项

1. **关键词匹配可能过于宽松**：如果发现误匹配，可以调整阈值
2. **子串匹配可能误匹配**：如果发现误匹配，可以调整最小长度要求
3. **性能考虑**：如果 FAQ 数据量很大，可能需要优化匹配算法

